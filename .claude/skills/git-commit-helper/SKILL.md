---
name: Git コミットヘルパー
description: git diff を分析して説明的なコミットメッセージを生成します。コミットメッセージの作成支援やステージングされた変更のレビューを依頼されたときに使用します。
---

# Git コミットヘルパー

## クイックスタート

ステージングされた変更を分析し、コミットメッセージを生成する:

```bash
# ステージングされた変更を表示
git diff --staged

# 変更内容に基づいてコミットメッセージを生成
# (Claude が diff を分析してメッセージを提案します)
```

## コミットメッセージのフォーマット

Conventional Commits 形式に従う:

```
<type>(<scope>): <description>

[任意の本文]

[任意のフッター]
```

### タイプ一覧

- **feat**: 新機能
- **fix**: バグ修正
- **docs**: ドキュメントの変更
- **style**: コードスタイルの変更（フォーマット、セミコロンの欠落など）
- **refactor**: コードのリファクタリング
- **test**: テストの追加または更新
- **chore**: メンテナンスタスク

### 例

**機能追加のコミット:**
```
feat(auth): JWT認証を追加

JWT ベースの認証システムを実装:
- トークン生成を行うログインエンドポイント
- トークン検証ミドルウェア
- リフレッシュトークンのサポート
```

**バグ修正:**
```
fix(api): ユーザープロフィールの null 値を処理

ユーザープロフィールのフィールドが null の場合のクラッシュを防止。
ネストされたプロパティにアクセスする前に null チェックを追加。
```

**リファクタリング:**
```
refactor(database): クエリビルダーを簡素化

共通のクエリパターンを再利用可能な関数に抽出。
データベース層のコード重複を削減。
```

## 変更内容の分析

コミット対象の内容を確認:

```bash
# 変更されたファイルを表示
git status

# 詳細な変更を表示
git diff --staged

# 統計情報を表示
git diff --staged --stat

# 特定ファイルの変更を表示
git diff --staged path/to/file
```

## コミットメッセージのガイドライン

**推奨:**

- 命令形を使用する（「機能を追加」ではなく「機能を追加する」）
- 1行目は50文字以内に収める
- 先頭を大文字にする（英語の場合）
- 要約の末尾にピリオドを付けない
- 本文では WHAT（何を）ではなく WHY（なぜ）を説明する

**非推奨:**

- 「update」や「fix stuff」のような曖昧なメッセージ
- 要約に技術的な実装詳細を含める
- 要約行に長文を書く
- 過去形を使用する

## 複数ファイルのコミット

関連する複数の変更をコミットする場合:

```
refactor(core): 認証モジュールを再構成

- 認証ロジックをコントローラーからサービス層に移動
- バリデーションを個別のバリデーターに抽出
- 新しい構造に合わせてテストを更新
- 認証フローの統合テストを追加

破壊的変更: Auth サービスに config オブジェクトが必要になりました
```

## スコープの例

**フロントエンド:**

- `feat(ui): ダッシュボードにローディングスピナーを追加`
- `fix(form): メールフォーマットを検証`

**バックエンド:**

- `feat(api): ユーザープロフィールエンドポイントを追加`
- `fix(db): コネクションプールのリークを解決`

**インフラストラクチャ:**

- `chore(ci): Node バージョンを 20 に更新`
- `feat(docker): マルチステージビルドを追加`

## 破壊的変更

破壊的変更は明確に示す:

```
feat(api)!: API レスポンスフォーマットを再構成

BREAKING CHANGE: すべての API レスポンスが JSON:API 仕様に準拠するようになりました

以前のフォーマット:
{ "data": {...}, "status": "ok" }

新しいフォーマット:
{ "data": {...}, "meta": {...} }

移行ガイド: クライアントコードを新しいレスポンス構造に対応するよう更新してください
```

## テンプレートワークフロー

1. **変更を確認**: `git diff --staged`
2. **タイプを特定**: feat, fix, refactor など、どれに該当するか？
3. **スコープを決定**: コードベースのどの部分か？
4. **要約を記述**: 簡潔で命令形の説明
5. **本文を追加**: 理由と影響を説明
6. **破壊的変更を記載**: 該当する場合

## 対話的コミットヘルパー

`git add -p` を使用して選択的にステージング:

```bash
# 対話的に変更をステージング
git add -p

# ステージングされた内容を確認
git diff --staged

# メッセージを付けてコミット
git commit -m "type(scope): description"
```

## コミットの修正

直前のコミットメッセージを修正:

```bash
# コミットメッセージのみを修正
git commit --amend

# 追加の変更を含めて修正
git add forgotten-file.js
git commit --amend --no-edit
```

## ベストプラクティス

1. **アトミックなコミット** - 1つの論理的な変更につき1コミット
2. **コミット前にテスト** - コードが動作することを確認
3. **Issue を参照** - 該当する場合は Issue 番号を含める
4. **焦点を絞る** - 無関係な変更を混ぜない
5. **人間のために書く** - 将来の自分がこれを読むことになる

## コミットメッセージチェックリスト

- [ ] タイプが適切か（feat/fix/docs など）
- [ ] スコープが具体的で明確か
- [ ] 要約が50文字以内か
- [ ] 要約が命令形になっているか
- [ ] 本文が WHAT ではなく WHY を説明しているか
- [ ] 破壊的変更が明確にマークされているか
- [ ] 関連する Issue 番号が含まれているか
